<!DOCTYPE html>
<html>
<head>
    <title>React Voice Test</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
    function VoiceTest() {
        const [status, setStatus] = React.useState('Not started');
        const [transcript, setTranscript] = React.useState('');
        const [logs, setLogs] = React.useState([]);
        
        const addLog = (msg) => {
            console.log(msg);
            setLogs(prev => [...prev, `${new Date().toLocaleTimeString()} - ${msg}`]);
        };
        
        const testVoice = async () => {
            addLog('Testing voice...');
            
            // First check microphone permission
            try {
                addLog('Requesting microphone permission...');
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                addLog('Microphone permission granted!');
                stream.getTracks().forEach(track => track.stop());
            } catch (e) {
                addLog('Microphone permission error: ' + e.message);
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                addLog('No speech recognition support');
                return;
            }
            
            try {
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    addLog('Recognition started');
                    setStatus('Listening...');
                };
                
                recognition.onaudiostart = () => {
                    addLog('Audio capture started');
                };
                
                recognition.onresult = (event) => {
                    const last = event.results[event.results.length - 1];
                    const text = last[0].transcript;
                    addLog('Transcript: ' + text);
                    setTranscript(text);
                };
                
                recognition.onerror = (event) => {
                    addLog('Error: ' + event.error);
                    setStatus('Error: ' + event.error);
                };
                
                recognition.onend = () => {
                    addLog('Recognition ended');
                    setStatus('Ended');
                };
                
                addLog('Starting recognition...');
                recognition.start();
                
                // Store reference
                window.testRecognition = recognition;
                
            } catch (e) {
                addLog('Exception: ' + e.message);
            }
        };
        
        const stopVoice = () => {
            if (window.testRecognition) {
                window.testRecognition.stop();
                window.testRecognition = null;
            }
        };
        
        return (
            <div style={{ padding: '20px' }}>
                <h1>React Voice Test</h1>
                <p>This tests if voice recognition works in a standalone React app.</p>
                
                <button onClick={testVoice}>Start Voice Test</button>
                <button onClick={stopVoice}>Stop</button>
                
                <div style={{ marginTop: '20px' }}>
                    <strong>Status:</strong> {status}
                </div>
                
                <div style={{ marginTop: '10px' }}>
                    <strong>Transcript:</strong> {transcript}
                </div>
                
                <div style={{ marginTop: '20px' }}>
                    <strong>Logs:</strong>
                    <div style={{ 
                        border: '1px solid #ccc', 
                        padding: '10px', 
                        maxHeight: '300px', 
                        overflow: 'auto',
                        fontFamily: 'monospace',
                        fontSize: '12px'
                    }}>
                        {logs.map((log, i) => (
                            <div key={i}>{log}</div>
                        ))}
                    </div>
                </div>
            </div>
        );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<VoiceTest />);
    </script>
</body>
</html>