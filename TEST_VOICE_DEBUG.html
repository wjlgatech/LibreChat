<!DOCTYPE html>
<html>
<head>
    <title>Voice Debug Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; }
        #log { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; }
        .log-entry { margin: 2px 0; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Voice Recognition Debug Test</h1>
    <button onclick="testVoice()">Test Voice Recognition</button>
    <button onclick="clearLog()">Clear Log</button>
    <h3>Transcript:</h3>
    <div id="transcript" style="border: 1px solid #ccc; padding: 10px; min-height: 50px;"></div>
    <h3>Debug Log:</h3>
    <div id="log"></div>
    
    <script>
    let recognition;
    
    function log(message, type = 'info') {
        const logDiv = document.getElementById('log');
        const entry = document.createElement('div');
        entry.className = 'log-entry ' + type;
        entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(message);
    }
    
    function clearLog() {
        document.getElementById('log').innerHTML = '';
        document.getElementById('transcript').innerHTML = '';
    }
    
    function testVoice() {
        try {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                log('Speech recognition not supported', 'error');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            log('Created recognition object', 'success');
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            let finalTranscript = '';
            
            recognition.onstart = () => {
                log('Recognition started', 'success');
            };
            
            recognition.onaudiostart = () => {
                log('Audio capture started', 'success');
            };
            
            recognition.onsoundstart = () => {
                log('Sound detected', 'info');
            };
            
            recognition.onspeechstart = () => {
                log('Speech detected!', 'success');
            };
            
            recognition.onresult = (event) => {
                log('Result event - results length: ' + event.results.length, 'info');
                
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                        log('Final: ' + transcript, 'success');
                    } else {
                        interimTranscript += transcript;
                        log('Interim: ' + transcript, 'info');
                    }
                }
                
                document.getElementById('transcript').textContent = finalTranscript + interimTranscript;
            };
            
            recognition.onerror = (event) => {
                log('Error: ' + event.error, 'error');
                if (event.error === 'no-speech') {
                    log('No speech detected - make sure to speak after clicking start', 'error');
                }
            };
            
            recognition.onend = () => {
                log('Recognition ended', 'info');
            };
            
            recognition.onspeechend = () => {
                log('Speech ended', 'info');
            };
            
            recognition.onaudioend = () => {
                log('Audio capture ended', 'info');
            };
            
            recognition.onsoundend = () => {
                log('Sound ended', 'info');
            };
            
            log('Starting recognition...', 'info');
            recognition.start();
            
        } catch (e) {
            log('Exception: ' + e.message, 'error');
            console.error(e);
        }
    }
    </script>
</body>
</html>